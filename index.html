<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HouseHub - Controle Doméstico</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.24.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.24.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.24.0/firebase-firestore.js"></script>

<style>
body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; background: #f7f7f7; }
input, button, select { display: block; width: 100%; padding: 10px; margin: 8px 0; box-sizing: border-box; }
button { background: #4caf50; color: white; border: none; cursor: pointer; }
button:hover { background: #43a047; }
#login, #logout { margin-top: 20px; }
</style>
</head>
<body>

<h1>HouseHub - Controle Doméstico</h1>

<button id="login">Entrar com Google</button>
<button id="logout" style="display:none;">Sair</button>

<div id="conteudo" style="display:none;">
  <h2>Adicionar Groceries</h2>
  <form id="groceriesForm">
    <input type="text" id="gName" placeholder="Name" required />
    <select id="gType" required>
      <option value="">Escolha o tipo</option>
      <option value="Mercado">Mercado</option>
      <option value="Padaria">Padaria</option>
      <option value="Farmácia">Farmácia</option>
    </select>
    <input type="date" id="gDate" required />
    <input type="text" id="gTotalCost" placeholder="Total Cost (ex: R$ 20,42)" required />
    <button type="submit">Adicionar</button>
  </form>

  <h2>Adicionar Product</h2>
  <form id="productsForm">
    <input type="text" id="pName" placeholder="Name" required />
    <input type="text" id="pCategory" placeholder="Category" required />
    <input type="text" id="pFullPrice" placeholder="Full Price (ex: R$ 20,42)" required />
    <input type="number" id="pAmount" placeholder="Amount" required />
    <input type="text" id="pAmountUnit" placeholder="Amount Unit" required />
    <input type="text" id="pUnitPrice" placeholder="Unit Price (ex: R$ 20,42)" required />
    <input type="checkbox" id="pCheck" /> Checked
    <input type="date" id="pGroceryDate" required />
    <button type="submit">Adicionar</button>
  </form>

  <p id="status"></p>
</div>

<script>
  // Config Firebase (substitua pelos seus valores)
  const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "SEU_PROJETO.firebaseapp.com",
    projectId: "SEU_PROJETO",
    storageBucket: "SEU_PROJETO.appspot.com",
    messagingSenderId: "SEU_SENDER_ID",
    appId: "SEU_APP_ID",
    measurementId: "SEU_MEASUREMENT_ID"
  };

  // Inicializa Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Login Google
  const provider = new firebase.auth.GoogleAuthProvider();

  document.getElementById("login").onclick = async () => {
    try {
      await auth.signInWithPopup(provider);
    } catch(e) { alert(e.message); }
  };

  document.getElementById("logout").onclick = async () => {
    await auth.signOut();
  };

  auth.onAuthStateChanged(user => {
    if(user){
      document.getElementById("login").style.display = "none";
      document.getElementById("logout").style.display = "block";
      document.getElementById("conteudo").style.display = "block";
    } else {
      document.getElementById("login").style.display = "block";
      document.getElementById("logout").style.display = "none";
      document.getElementById("conteudo").style.display = "none";
    }
  });

  // Converte valor em R$ para centavos
  function parseCurrency(value){
    return Math.round(parseFloat(value.replace("R$", "").replace(",", ".")) * 100);
  }

  // Converte input date para Timestamp
  function toTimestamp(value){
    return firebase.firestore.Timestamp.fromDate(new Date(value));
  }

  // Envia Groceries
  document.getElementById("groceriesForm").onsubmit = async (e)=>{
    e.preventDefault();
    try{
      await db.collection("Groceries").add({
        name: document.getElementById("gName").value,
        type: document.getElementById("gType").value,
        date: toTimestamp(document.getElementById("gDate").value),
        totalCostCents: parseCurrency(document.getElementById("gTotalCost").value)
      });
      document.getElementById("status").innerText = "Groceries adicionada!";
      e.target.reset();
    } catch(err){
      document.getElementById("status").innerText = "Erro: "+err.message;
    }
  };

  // Envia Product
  document.getElementById("productsForm").onsubmit = async (e)=>{
    e.preventDefault();
    try{
      await db.collection("Products").add({
        name: document.getElementById("pName").value,
        category: document.getElementById("pCategory").value,
        fullPriceCents: parseCurrency(document.getElementById("pFullPrice").value),
        amount: Number(document.getElementById("pAmount").value),
        amountUnit: document.getElementById("pAmountUnit").value,
        unitPriceCents: parseCurrency(document.getElementById("pUnitPrice").value),
        check: document.getElementById("pCheck").checked,
        groceryDate: toTimestamp(document.getElementById("pGroceryDate").value)
      });
      document.getElementById("status").innerText = "Product adicionado!";
      e.target.reset();
    } catch(err){
      document.getElementById("status").innerText = "Erro: "+err.message;
    }
  };
</script>
</body>
</html>
